<!--pages/login/login.wxml-->
<view class="login-container">
  <!-- 顶部装饰 -->
  <view class="header-decoration">
    <view class="decoration-circle circle-1"></view>
    <view class="decoration-circle circle-2"></view>
    <view class="decoration-circle circle-3"></view>
  </view>

  <!-- Logo和标题 -->
  <view class="logo-section">
    <image class="logo" src="/images/logo.png" mode="aspectFit" />
    <text class="app-title">智慧教育小程序</text>
    <text class="app-subtitle">让学习更高效，让教育更智能</text>
  </view>

  <!-- 身份选择 -->
  <view class="identity-section">
    <text class="section-title">请选择您的身份</text>
    <view class="identity-options">
      <view 
        class="identity-item {{selectedIdentity === 'student' ? 'active' : ''}}"
        bindtap="selectIdentity"
        data-identity="student"
      >
        <image class="identity-icon" src="/images/icon_student.png" />
        <text class="identity-text">学生</text>
        <view class="identity-desc">完成作业，获得积分奖励</view>
      </view>
      
      <view 
        class="identity-item {{selectedIdentity === 'teacher' ? 'active' : ''}}"
        bindtap="selectIdentity"
        data-identity="teacher"
      >
        <image class="identity-icon" src="/images/icon_teacher.png" />
        <text class="identity-text">教师</text>
        <view class="identity-desc">管理班级，布置批改作业</view>
      </view>
      
      <view 
        class="identity-item {{selectedIdentity === 'parent' ? 'active' : ''}}"
        bindtap="selectIdentity"
        data-identity="parent"
      >
        <image class="identity-icon" src="/images/icon_parent.png" />
        <text class="identity-text">家长</text>
        <view class="identity-desc">查看孩子学习情况</view>
      </view>
    </view>
  </view>

  <!-- 登录表单 -->
  <view class="login-form" wx:if="{{selectedIdentity}}">
    <!-- 手机号登录 -->
    <view class="login-method" wx:if="{{loginMethod === 'phone'}}">
      <view class="form-group">
        <view class="input-wrapper">
          <image class="input-icon" src="/images/icon_phone.png" />
          <input 
            class="form-input"
            type="number"
            placeholder="请输入手机号"
            value="{{phone}}"
            bindinput="onPhoneInput"
            maxlength="11"
          />
        </view>
      </view>
      
      <view class="form-group">
        <view class="input-wrapper">
          <image class="input-icon" src="/images/icon_code.png" />
          <input 
            class="form-input code-input"
            type="number"
            placeholder="请输入验证码"
            value="{{verifyCode}}"
            bindinput="onCodeInput"
            maxlength="6"
          />
          <button 
            class="send-code-btn {{canSendCode ? '' : 'disabled'}}"
            bindtap="sendVerifyCode"
            disabled="{{!canSendCode}}"
          >
            {{codeButtonText}}
          </button>
        </view>
      </view>
    </view>

    <!-- 微信授权登录 -->
    <view class="login-method" wx:if="{{loginMethod === 'wechat'}}">
      <button 
        class="wechat-login-btn"
        open-type="getUserProfile"
        bindgetuserprofile="onGetUserProfile"
      >
        <image class="wechat-icon" src="/images/icon_wechat.png" />
        <text>微信授权登录</text>
      </button>
    </view>

    <!-- 登录按钮 -->
    <button 
      class="login-btn {{(canLogin && agreedToTerms) ? '' : 'disabled'}}"
      bindtap="handleLogin"
      disabled="{{!(canLogin && agreedToTerms)}}"
      loading="{{loginLoading}}"
    >
      {{loginLoading ? '登录中...' : '立即登录'}}
    </button>

    <!-- 登录方式切换 -->
    <view class="login-switch">
      <text 
        class="switch-text {{loginMethod === 'phone' ? 'active' : ''}}"
        bindtap="switchLoginMethod"
        data-method="phone"
      >
        手机号登录
      </text>
      <text class="switch-divider">|</text>
      <text 
        class="switch-text {{loginMethod === 'wechat' ? 'active' : ''}}"
        bindtap="switchLoginMethod"
        data-method="wechat"
      >
        微信登录
      </text>
    </view>
  </view>

  <!-- 注册链接 -->
  <view class="register-section" wx:if="{{selectedIdentity && loginMethod === 'phone'}}">
    <text class="register-text">还没有账号？</text>
    <text class="register-link" bindtap="goToRegister">立即注册</text>
  </view>

  <!-- 协议条款 -->
  <view class="agreement-section">
    <view class="agreement-checkbox" bindtap="toggleAgreement">
      <view class="checkbox-box {{agreedToTerms ? 'checked' : ''}}">
        <view class="checkbox-tick" wx:if="{{agreedToTerms}}"></view>
      </view>
      <text class="agreement-text" catchtap="noop">
        我已阅读并同意
        <text class="agreement-link" bindtap="viewUserAgreement" catchtap="viewUserAgreement">《用户协议》</text>
        和
        <text class="agreement-link" bindtap="viewPrivacyPolicy" catchtap="viewPrivacyPolicy">《隐私政策》</text>
      </text>
    </view>
  </view>

  <!-- 底部装饰 -->
  <view class="footer-decoration">
    <view class="decoration-wave"></view>
  </view>
</view>

<!-- Toast提示 -->
<view class="toast {{showToast ? 'show' : ''}}">
  <text>{{toastMessage}}</text>
</view>

<!-- 加载遮罩 -->
<view class="loading-mask" wx:if="{{loginLoading}}">
  <view class="loading-content">
    <image class="loading-icon" src="/images/loading.gif" />
    <text class="loading-text">登录中，请稍候...</text>
  </view>
</view>