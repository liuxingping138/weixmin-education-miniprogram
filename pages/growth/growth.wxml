<!--pages/growth/growth.wxml-->
<view class="growth-container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <t-loading wx:if="{{loading}}" theme="circular" size="40rpx" text="åŠ è½½ä¸­..." />
  
  <!-- é¡¶éƒ¨åŠŸèƒ½ä»‹ç» -->
  <view class="header-section">
    <view class="feature-intro">
      <view class="intro-icon">ğŸ“Š</view>
      <view class="intro-content">
        <view class="intro-title">æˆé•¿åˆ†æ</view>
        <view class="intro-desc">å…¨æ–¹ä½åˆ†æå­¦ç”Ÿèƒ½åŠ›å‘å±•è½¨è¿¹</view>
      </view>
    </view>
    
    <!-- å­¦ç”Ÿé€‰æ‹©å™¨ -->
    <view class="student-selector">
      <view class="selector-label">é€‰æ‹©å­¦ç”Ÿ</view>
      <view class="student-options">
        <view 
          wx:for="{{students}}" 
          wx:key="id"
          class="student-option {{selectedStudent === item.id ? 'selected' : ''}}"
          data-student="{{item.id}}"
          bindtap="selectStudent"
        >
          <image src="{{item.avatar}}" class="student-avatar" />
          <view class="student-name">{{item.name}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½å¯¼èˆª -->
  <view class="nav-tabs">
    <view 
      class="nav-tab {{activeTab === 'ability' ? 'active' : ''}}"
      data-tab="ability"
      bindtap="switchTab"
    >
      <view class="tab-icon">ğŸ¯</view>
      <view class="tab-text">èƒ½åŠ›åˆ†æ</view>
    </view>
    <view 
      class="nav-tab {{activeTab === 'archive' ? 'active' : ''}}"
      data-tab="archive"
      bindtap="switchTab"
    >
      <view class="tab-icon">ğŸ“š</view>
      <view class="tab-text">æˆé•¿æ¡£æ¡ˆ</view>
    </view>
    <view 
      class="nav-tab {{activeTab === 'report' ? 'active' : ''}}"
      data-tab="report"
      bindtap="switchTab"
    >
      <view class="tab-icon">ğŸ“‹</view>
      <view class="tab-text">åˆ†ææŠ¥å‘Š</view>
    </view>
  </view>

  <!-- èƒ½åŠ›åˆ†æé¡µé¢ -->
  <view class="tab-content" wx:if="{{activeTab === 'ability'}}">
    <!-- å…­è¾¹å½¢èƒ½åŠ›é›·è¾¾å›¾ -->
    <view class="ability-radar">
      <view class="radar-header">
        <view class="header-title">
          <view class="title-icon">ğŸ¯</view>
          <text>å…­ç»´èƒ½åŠ›åˆ†æ</text>
        </view>
        <view class="header-actions">
          <view class="time-selector">
            <view 
              wx:for="{{timePeriods}}" 
              wx:key="id"
              class="time-option {{selectedTimePeriod === item.id ? 'active' : ''}}"
              data-period="{{item.id}}"
              bindtap="selectTimePeriod"
            >
              {{item.name}}
            </view>
          </view>
        </view>
      </view>
      
      <view class="radar-chart">
        <!-- å…­è¾¹å½¢é›·è¾¾å›¾å®¹å™¨ -->
        <canvas 
          canvas-id="abilityRadar" 
          class="radar-canvas"
          bindtouchstart="onRadarTouch"
        ></canvas>
        
        <!-- èƒ½åŠ›ç»´åº¦è¯´æ˜ -->
        <view class="ability-legend">
          <view 
            wx:for="{{abilityDimensions}}" 
            wx:key="id"
            class="legend-item"
            style="border-left-color: {{item.color}}"
          >
            <view class="legend-name">{{item.name}}</view>
            <view class="legend-score">{{item.score}}</view>
            <view class="legend-level">{{item.level}}</view>
          </view>
        </view>
      </view>
      
      <!-- èƒ½åŠ›è¯¦ç»†åˆ†æ -->
      <view class="ability-details">
        <view class="details-header">
          <view class="header-title">
            <view class="title-icon">ğŸ“ˆ</view>
            <text>èƒ½åŠ›è¯¦æƒ…</text>
          </view>
        </view>
        
        <view class="ability-list">
          <view 
            wx:for="{{abilityDimensions}}" 
            wx:key="id"
            class="ability-item"
            data-ability="{{item}}"
            bindtap="viewAbilityDetail"
          >
            <view class="ability-icon" style="background: {{item.color}}">{{item.icon}}</view>
            <view class="ability-info">
              <view class="ability-name">{{item.name}}</view>
              <view class="ability-desc">{{item.description}}</view>
              <view class="ability-progress">
                <view class="progress-bar">
                  <view 
                    class="progress-fill" 
                    style="width: {{item.score}}%; background: {{item.color}}"
                  ></view>
                </view>
                <view class="progress-text">{{item.score}}/100</view>
              </view>
            </view>
            <view class="ability-trend">
              <view class="trend-icon {{item.trend}}">{{item.trendIcon}}</view>
              <view class="trend-text">{{item.trendText}}</view>
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- èƒ½åŠ›å‘å±•è¶‹åŠ¿ -->
    <view class="ability-trends">
      <view class="trends-header">
        <view class="header-title">
          <view class="title-icon">ğŸ“Š</view>
          <text>å‘å±•è¶‹åŠ¿</text>
        </view>
      </view>
      
      <view class="trend-chart">
        <canvas 
          canvas-id="trendChart" 
          class="trend-canvas"
        ></canvas>
      </view>
      
      <view class="trend-summary">
        <view class="summary-item">
          <view class="summary-label">æœ€å¼ºèƒ½åŠ›</view>
          <view class="summary-value">{{strongestAbility.name}}</view>
          <view class="summary-score">{{strongestAbility.score}}åˆ†</view>
        </view>
        <view class="summary-item">
          <view class="summary-label">å¾…æå‡</view>
          <view class="summary-value">{{weakestAbility.name}}</view>
          <view class="summary-score">{{weakestAbility.score}}åˆ†</view>
        </view>
        <view class="summary-item">
          <view class="summary-label">è¿›æ­¥æœ€å¿«</view>
          <view class="summary-value">{{fastestGrowth.name}}</view>
          <view class="summary-score">+{{fastestGrowth.growth}}åˆ†</view>
        </view>
      </view>
    </view>
  </view>

  <!-- æˆé•¿æ¡£æ¡ˆé¡µé¢ -->
  <view class="tab-content" wx:if="{{activeTab === 'archive'}}">
    <!-- æ¡£æ¡ˆæ¦‚è§ˆ -->
    <view class="archive-overview">
      <view class="overview-header">
        <view class="header-title">
          <view class="title-icon">ğŸ‘¤</view>
          <text>å­¦ç”Ÿæ¡£æ¡ˆ</text>
        </view>
        <view class="header-actions">
          <t-button size="small" theme="primary" bind:tap="exportArchive">
            å¯¼å‡ºæ¡£æ¡ˆ
          </t-button>
        </view>
      </view>
      
      <view class="student-profile" wx:if="{{currentStudentProfile}}">
        <view class="profile-header">
          <image src="{{currentStudentProfile.avatar}}" class="profile-avatar" />
          <view class="profile-info">
            <view class="profile-name">{{currentStudentProfile.name}}</view>
            <view class="profile-class">{{currentStudentProfile.className}}</view>
            <view class="profile-id">å­¦å·ï¼š{{currentStudentProfile.studentId}}</view>
          </view>
          <view class="profile-stats">
            <view class="stat-item">
              <view class="stat-value">{{currentStudentProfile.totalDays}}</view>
              <view class="stat-label">åœ¨æ ¡å¤©æ•°</view>
            </view>
            <view class="stat-item">
              <view class="stat-value">{{currentStudentProfile.totalPoints}}</view>
              <view class="stat-label">æ€»ç§¯åˆ†</view>
            </view>
          </view>
        </view>
        
        <view class="profile-achievements">
          <view class="achievements-title">ä¸»è¦æˆå°±</view>
          <view class="achievement-tags">
            <view 
              wx:for="{{currentStudentProfile.achievements}}" 
              wx:key="*this"
              class="achievement-tag"
            >
              {{item}}
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- æˆé•¿æ—¶é—´è½´ -->
    <view class="growth-timeline">
      <view class="timeline-header">
        <view class="header-title">
          <view class="title-icon">ğŸŒ±</view>
          <text>æˆé•¿è½¨è¿¹</text>
        </view>
        <view class="header-filter">
          <view 
            wx:for="{{timelineFilters}}" 
            wx:key="id"
            class="filter-option {{selectedTimelineFilter === item.id ? 'active' : ''}}"
            data-filter="{{item.id}}"
            bindtap="selectTimelineFilter"
          >
            {{item.name}}
          </view>
        </view>
      </view>
      
      <view class="timeline-content">
        <view 
          wx:for="{{filteredTimelineEvents}}" 
          wx:key="id"
          class="timeline-event"
        >
          <view class="event-date">
            <view class="date-month">{{item.month}}</view>
            <view class="date-day">{{item.day}}</view>
          </view>
          <view class="event-line"></view>
          <view class="event-content">
            <view class="event-header">
              <view class="event-type {{item.type}}">{{item.typeIcon}}</view>
              <view class="event-title">{{item.title}}</view>
              <view class="event-time">{{item.time}}</view>
            </view>
            <view class="event-desc">{{item.description}}</view>
            <view class="event-media" wx:if="{{item.images && item.images.length > 0}}">
              <image 
                wx:for="{{item.images}}" 
                wx:for-item="img" 
                wx:key="*this"
                src="{{img}}"
                class="event-image"
                mode="aspectFill"
                data-images="{{item.images}}"
                data-current="{{index}}"
                bindtap="previewImages"
              />
            </view>
            <view class="event-tags" wx:if="{{item.tags && item.tags.length > 0}}">
              <view 
                wx:for="{{item.tags}}" 
                wx:for-item="tag" 
                wx:key="*this"
                class="event-tag"
              >
                {{tag}}
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- å­¦ä¹ ç»Ÿè®¡ -->
    <view class="learning-stats">
      <view class="stats-header">
        <view class="header-title">
          <view class="title-icon">ğŸ“Š</view>
          <text>å­¦ä¹ ç»Ÿè®¡</text>
        </view>
      </view>
      
      <view class="stats-grid">
        <view class="stat-card">
          <view class="card-icon homework">ğŸ“</view>
          <view class="card-content">
            <view class="card-title">ä½œä¸šå®Œæˆ</view>
            <view class="card-value">{{learningStats.homeworkCompleted}}</view>
            <view class="card-total">/ {{learningStats.homeworkTotal}}</view>
            <view class="card-rate">å®Œæˆç‡ {{learningStats.homeworkRate}}%</view>
          </view>
        </view>
        
        <view class="stat-card">
          <view class="card-icon test">ğŸ¯</view>
          <view class="card-content">
            <view class="card-title">æµ‹è¯•æˆç»©</view>
            <view class="card-value">{{learningStats.averageScore}}</view>
            <view class="card-unit">åˆ†</view>
            <view class="card-rate">å¹³å‡åˆ†</view>
          </view>
        </view>
        
        <view class="stat-card">
          <view class="card-icon activity">ğŸ†</view>
          <view class="card-content">
            <view class="card-title">æ´»åŠ¨å‚ä¸</view>
            <view class="card-value">{{learningStats.activitiesJoined}}</view>
            <view class="card-total">æ¬¡</view>
            <view class="card-rate">ç§¯æå‚ä¸</view>
          </view>
        </view>
        
        <view class="stat-card">
          <view class="card-icon points">â­</view>
          <view class="card-content">
            <view class="card-title">è·å¾—ç§¯åˆ†</view>
            <view class="card-value">{{learningStats.pointsEarned}}</view>
            <view class="card-unit">åˆ†</view>
            <view class="card-rate">æœ¬æœˆè·å¾—</view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åˆ†ææŠ¥å‘Šé¡µé¢ -->
  <view class="tab-content" wx:if="{{activeTab === 'report'}}">
    <!-- AIåˆ†ææŠ¥å‘Š -->
    <view class="ai-analysis">
      <view class="analysis-header">
        <view class="header-title">
          <view class="title-icon">ğŸ¤–</view>
          <text>AIæ™ºèƒ½åˆ†æ</text>
        </view>
        <view class="header-actions">
          <t-button 
            size="small" 
            theme="primary" 
            loading="{{generatingReport}}"
            bind:tap="generateAIReport"
          >
            {{generatingReport ? 'ç”Ÿæˆä¸­...' : 'é‡æ–°åˆ†æ'}}
          </t-button>
        </view>
      </view>
      
      <view class="analysis-content" wx:if="{{aiAnalysisReport}}">
        <!-- ç»¼åˆè¯„ä»· -->
        <view class="overall-assessment">
          <view class="assessment-header">
            <view class="assessment-title">ç»¼åˆè¯„ä»·</view>
            <view class="assessment-score">{{aiAnalysisReport.overallScore}}</view>
            <view class="assessment-level">{{aiAnalysisReport.overallLevel}}</view>
          </view>
          <view class="assessment-desc">{{aiAnalysisReport.overallDescription}}</view>
        </view>
        
        <!-- ä¼˜åŠ¿åˆ†æ -->
        <view class="strengths-analysis">
          <view class="section-title">
            <view class="title-icon">ğŸ’ª</view>
            <text>ä¼˜åŠ¿åˆ†æ</text>
          </view>
          <view class="analysis-list">
            <view 
              wx:for="{{aiAnalysisReport.strengths}}" 
              wx:key="*this"
              class="analysis-item strength"
            >
              <view class="item-icon">âœ…</view>
              <view class="item-text">{{item}}</view>
            </view>
          </view>
        </view>
        
        <!-- æ”¹è¿›å»ºè®® -->
        <view class="improvements-analysis">
          <view class="section-title">
            <view class="title-icon">ğŸ¯</view>
            <text>æ”¹è¿›å»ºè®®</text>
          </view>
          <view class="analysis-list">
            <view 
              wx:for="{{aiAnalysisReport.improvements}}" 
              wx:key="*this"
              class="analysis-item improvement"
            >
              <view class="item-icon">ğŸ’¡</view>
              <view class="item-text">{{item}}</view>
            </view>
          </view>
        </view>
        
        <!-- å­¦ä¹ è®¡åˆ’ -->
        <view class="learning-plan">
          <view class="section-title">
            <view class="title-icon">ğŸ“…</view>
            <text>ä¸ªæ€§åŒ–å­¦ä¹ è®¡åˆ’</text>
          </view>
          <view class="plan-timeline">
            <view 
              wx:for="{{aiAnalysisReport.learningPlan}}" 
              wx:key="id"
              class="plan-item"
            >
              <view class="plan-period">{{item.period}}</view>
              <view class="plan-content">
                <view class="plan-title">{{item.title}}</view>
                <view class="plan-desc">{{item.description}}</view>
                <view class="plan-goals">
                  <view 
                    wx:for="{{item.goals}}" 
                    wx:for-item="goal" 
                    wx:key="*this"
                    class="plan-goal"
                  >
                    â€¢ {{goal}}
                  </view>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- å†å²æŠ¥å‘Š -->
    <view class="history-reports">
      <view class="reports-header">
        <view class="header-title">
          <view class="title-icon">ğŸ“š</view>
          <text>å†å²æŠ¥å‘Š</text>
        </view>
      </view>
      
      <view class="report-list">
        <view 
          wx:for="{{historyReports}}" 
          wx:key="id"
          class="report-item"
          data-report="{{item}}"
          bindtap="viewHistoryReport"
        >
          <view class="report-icon">
            <view class="icon-bg {{item.type}}">{{item.typeIcon}}</view>
          </view>
          <view class="report-info">
            <view class="report-title">{{item.title}}</view>
            <view class="report-meta">
              <view class="meta-item">
                <view class="meta-icon">ğŸ“…</view>
                <text>{{item.createTime}}</text>
              </view>
              <view class="meta-item">
                <view class="meta-icon">â­</view>
                <text>{{item.score}}åˆ†</text>
              </view>
            </view>
            <view class="report-summary">{{item.summary}}</view>
          </view>
          <view class="report-actions">
            <t-button 
              size="small" 
              theme="light"
              data-report="{{item}}"
              bind:tap="downloadHistoryReport"
              catch:tap="true"
            >
              ä¸‹è½½
            </t-button>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <t-empty 
    wx:if="{{isEmpty && !loading}}"
    icon="data"
    description="æš‚æ— æ•°æ®"
  />

  <!-- Toastæç¤º -->
  <t-toast 
    visible="{{showToast}}"
    message="{{toastMessage}}"
    bind:close="onToastClose"
  />

  <!-- èƒ½åŠ›è¯¦æƒ…å¼¹çª— -->
  <t-popup 
    visible="{{showAbilityDetail}}"
    placement="bottom"
    bind:visible-change="onAbilityDetailClose"
  >
    <view class="ability-detail" wx:if="{{selectedAbility}}">
      <view class="detail-header">
        <view class="detail-title">{{selectedAbility.name}}èƒ½åŠ›è¯¦æƒ…</view>
        <view class="detail-close" bindtap="closeAbilityDetail">âœ•</view>
      </view>
      
      <view class="detail-content">
        <view class="ability-overview">
          <view class="overview-score">
            <view class="score-circle" style="border-color: {{selectedAbility.color}}">
              <view class="score-value">{{selectedAbility.score}}</view>
              <view class="score-max">/100</view>
            </view>
            <view class="score-level">{{selectedAbility.level}}</view>
          </view>
          <view class="overview-desc">{{selectedAbility.detailDescription}}</view>
        </view>
        
        <view class="ability-breakdown">
          <view class="breakdown-title">èƒ½åŠ›æ„æˆ</view>
          <view class="breakdown-list">
            <view 
              wx:for="{{selectedAbility.breakdown}}" 
              wx:key="name"
              class="breakdown-item"
            >
              <view class="breakdown-name">{{item.name}}</view>
              <view class="breakdown-progress">
                <view class="progress-bar">
                  <view 
                    class="progress-fill" 
                    style="width: {{item.score}}%; background: {{selectedAbility.color}}"
                  ></view>
                </view>
                <view class="progress-score">{{item.score}}</view>
              </view>
            </view>
          </view>
        </view>
        
        <view class="ability-suggestions">
          <view class="suggestions-title">æå‡å»ºè®®</view>
          <view class="suggestion-list">
            <view 
              wx:for="{{selectedAbility.suggestions}}" 
              wx:key="*this"
              class="suggestion-item"
            >
              ğŸ’¡ {{item}}
            </view>
          </view>
        </view>
      </view>
    </view>
  </t-popup>
</view>