<!--pages/courseware/courseware.wxml-->
<view class="courseware-container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <t-loading wx:if="{{loading}}" theme="circular" size="40rpx" text="åŠ è½½ä¸­..." />
  
  <!-- é¡¶éƒ¨åŠŸèƒ½ä»‹ç» -->
  <view class="header-section">
    <view class="feature-intro">
      <view class="intro-icon">ğŸ“š</view>
      <view class="intro-content">
        <view class="intro-title">æ™ºèƒ½è¯¾ä»¶åˆ¶ä½œ</view>
        <view class="intro-desc">AIé©±åŠ¨çš„è¯¾ä»¶ç”Ÿæˆï¼Œè®©æ•™å­¦æ›´ç”ŸåŠ¨æœ‰è¶£</view>
      </view>
    </view>
    
    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <view class="stats-grid">
      <view class="stat-item">
        <view class="stat-number">{{coursewareStats.totalCourseware}}</view>
        <view class="stat-label">åˆ¶ä½œè¯¾ä»¶</view>
      </view>
      <view class="stat-item">
        <view class="stat-number">{{coursewareStats.animations}}</view>
        <view class="stat-label">åŠ¨ç”»ç´ æ</view>
      </view>
      <view class="stat-item">
        <view class="stat-number">{{coursewareStats.templates}}</view>
        <view class="stat-label">æ¨¡æ¿åº“</view>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½å¯¼èˆª -->
  <view class="nav-tabs">
    <view 
      class="nav-tab {{activeTab === 'generate' ? 'active' : ''}}"
      data-tab="generate"
      bindtap="switchTab"
    >
      <view class="tab-icon">ğŸ¨</view>
      <view class="tab-text">PPTç”Ÿæˆ</view>
    </view>
    <view 
      class="nav-tab {{activeTab === 'animation' ? 'active' : ''}}"
      data-tab="animation"
      bindtap="switchTab"
    >
      <view class="tab-icon">ğŸ¬</view>
      <view class="tab-text">çŸ¥è¯†åŠ¨ç”»</view>
    </view>
    <view 
      class="nav-tab {{activeTab === 'library' ? 'active' : ''}}"
      data-tab="library"
      bindtap="switchTab"
    >
      <view class="tab-icon">ğŸ“–</view>
      <view class="tab-text">è¯¾ä»¶åº“</view>
    </view>
  </view>

  <!-- PPTç”Ÿæˆé¡µé¢ -->
  <view class="tab-content" wx:if="{{activeTab === 'generate'}}">
    <!-- ç”Ÿæˆé…ç½® -->
    <view class="generate-config">
      <view class="config-section">
        <view class="section-title">
          <view class="title-icon">ğŸ“‹</view>
          <text>è¯¾ä»¶é…ç½®</text>
        </view>
        
        <!-- ç§‘ç›®é€‰æ‹© -->
        <view class="config-item">
          <view class="item-label">é€‰æ‹©ç§‘ç›®</view>
          <view class="subject-grid">
            <view 
              wx:for="{{subjects}}" 
              wx:key="id"
              class="subject-item {{selectedSubject === item.id ? 'selected' : ''}}"
              data-subject="{{item.id}}"
              bindtap="selectSubject"
            >
              <view class="subject-icon">{{item.icon}}</view>
              <view class="subject-name">{{item.name}}</view>
            </view>
          </view>
        </view>
        
        <!-- ä¸»é¢˜è¾“å…¥ -->
        <view class="config-item">
          <view class="item-label">è¯¾ä»¶ä¸»é¢˜</view>
          <t-input 
            placeholder="è¯·è¾“å…¥è¯¾ä»¶ä¸»é¢˜ï¼Œå¦‚ï¼šäºŒæ¬¡å‡½æ•°çš„å›¾åƒä¸æ€§è´¨"
            value="{{coursewareTitle}}"
            bind:change="onTitleChange"
            maxlength="50"
          />
        </view>
        
        <!-- å†…å®¹è¦ç‚¹ -->
        <view class="config-item">
          <view class="item-label">å†…å®¹è¦ç‚¹</view>
          <view class="content-points">
            <view 
              wx:for="{{contentPoints}}" 
              wx:key="index"
              class="point-item"
            >
              <t-input 
                placeholder="è¯·è¾“å…¥è¦ç‚¹{{index + 1}}"
                value="{{item}}"
                data-index="{{index}}"
                bind:change="onPointChange"
                maxlength="100"
              />
              <view 
                class="point-delete"
                data-index="{{index}}"
                bindtap="deletePoint"
                wx:if="{{contentPoints.length > 1}}"
              >
                âŒ
              </view>
            </view>
            <view class="add-point" bindtap="addPoint" wx:if="{{contentPoints.length < 8}}">
              <view class="add-icon">â•</view>
              <text>æ·»åŠ è¦ç‚¹</text>
            </view>
          </view>
        </view>
        
        <!-- æ¨¡æ¿é€‰æ‹© -->
        <view class="config-item">
          <view class="item-label">é€‰æ‹©æ¨¡æ¿</view>
          <view class="template-grid">
            <view 
              wx:for="{{templates}}" 
              wx:key="id"
              class="template-item {{selectedTemplate === item.id ? 'selected' : ''}}"
              data-template="{{item.id}}"
              bindtap="selectTemplate"
            >
              <view class="template-preview">
                <image src="{{item.preview}}" class="template-image" mode="aspectFit" />
              </view>
              <view class="template-name">{{item.name}}</view>
            </view>
          </view>
        </view>
        
        <!-- ç”ŸæˆæŒ‰é’® -->
        <view class="generate-actions">
          <t-button 
            theme="primary" 
            size="large"
            loading="{{generating}}"
            disabled="{{!canGenerate}}"
            bind:tap="generateCourseware"
          >
            {{generating ? 'ç”Ÿæˆä¸­...' : 'å¼€å§‹ç”Ÿæˆ'}}
          </t-button>
        </view>
      </view>
    </view>
    
    <!-- ç”Ÿæˆç»“æœ -->
    <view class="generate-result" wx:if="{{generatedCourseware.length > 0}}">
      <view class="result-header">
        <view class="result-title">
          <view class="title-icon">âœ¨</view>
          <text>ç”Ÿæˆç»“æœ</text>
        </view>
        <view class="result-actions">
          <t-button size="small" theme="light" bind:tap="previewCourseware">
            é¢„è§ˆ
          </t-button>
          <t-button size="small" theme="primary" bind:tap="downloadCourseware">
            ä¸‹è½½
          </t-button>
        </view>
      </view>
      
      <view class="slide-list">
        <view 
          wx:for="{{generatedCourseware}}" 
          wx:key="id"
          class="slide-item"
          data-slide="{{item}}"
          bindtap="viewSlide"
        >
          <view class="slide-preview">
            <image src="{{item.preview}}" class="slide-image" mode="aspectFit" />
          </view>
          <view class="slide-info">
            <view class="slide-title">{{item.title}}</view>
            <view class="slide-desc">{{item.description}}</view>
          </view>
          <view class="slide-number">{{index + 1}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- çŸ¥è¯†åŠ¨ç”»é¡µé¢ -->
  <view class="tab-content" wx:if="{{activeTab === 'animation'}}">
    <!-- åŠ¨ç”»åˆ†ç±» -->
    <view class="animation-categories">
      <view class="category-tabs">
        <view 
          wx:for="{{animationCategories}}" 
          wx:key="id"
          class="category-tab {{selectedAnimationCategory === item.id ? 'active' : ''}}"
          data-category="{{item.id}}"
          bindtap="selectAnimationCategory"
        >
          {{item.name}}
        </view>
      </view>
    </view>
    
    <!-- åŠ¨ç”»åˆ—è¡¨ -->
    <view class="animation-list">
      <view 
        wx:for="{{filteredAnimations}}" 
        wx:key="id"
        class="animation-item"
        data-animation="{{item}}"
        bindtap="viewAnimation"
      >
        <view class="animation-preview">
          <image src="{{item.thumbnail}}" class="animation-thumbnail" mode="aspectFit" />
          <view class="play-overlay">
            <view class="play-icon">â–¶ï¸</view>
          </view>
        </view>
        <view class="animation-info">
          <view class="animation-title">{{item.title}}</view>
          <view class="animation-desc">{{item.description}}</view>
          <view class="animation-meta">
            <view class="meta-item">
              <view class="meta-icon">ğŸ“š</view>
              <text>{{item.subject}}</text>
            </view>
            <view class="meta-item">
              <view class="meta-icon">â±ï¸</view>
              <text>{{item.duration}}åˆ†é’Ÿ</text>
            </view>
            <view class="meta-item">
              <view class="meta-icon">ğŸ‘ï¸</view>
              <text>{{item.views}}</text>
            </view>
          </view>
        </view>
        <view class="animation-actions">
          <t-button 
            size="small" 
            theme="light"
            data-animation="{{item}}"
            bind:tap="collectAnimation"
            catch:tap="true"
          >
            {{item.collected ? 'å·²æ”¶è—' : 'æ”¶è—'}}
          </t-button>
        </view>
      </view>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <t-empty 
      wx:if="{{filteredAnimations.length === 0 && !loading}}"
      icon="search"
      description="æš‚æ— ç›¸å…³åŠ¨ç”»"
    />
  </view>

  <!-- è¯¾ä»¶åº“é¡µé¢ -->
  <view class="tab-content" wx:if="{{activeTab === 'library'}}">
    <!-- ç­›é€‰æ¡ä»¶ -->
    <view class="library-filters">
      <view class="filter-row">
        <view class="filter-item">
          <view class="filter-label">ç§‘ç›®</view>
          <view class="filter-options">
            <view 
              wx:for="{{librarySubjects}}" 
              wx:key="id"
              class="filter-option {{selectedLibrarySubject === item.id ? 'active' : ''}}"
              data-subject="{{item.id}}"
              bindtap="selectLibrarySubject"
            >
              {{item.name}}
            </view>
          </view>
        </view>
      </view>
      
      <view class="filter-row">
        <view class="filter-item">
          <view class="filter-label">ç±»å‹</view>
          <view class="filter-options">
            <view 
              wx:for="{{coursewareTypes}}" 
              wx:key="id"
              class="filter-option {{selectedCoursewareType === item.id ? 'active' : ''}}"
              data-type="{{item.id}}"
              bindtap="selectCoursewareType"
            >
              {{item.name}}
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- è¯¾ä»¶åˆ—è¡¨ -->
    <view class="courseware-list">
      <view 
        wx:for="{{filteredCourseware}}" 
        wx:key="id"
        class="courseware-item"
        data-courseware="{{item}}"
        bindtap="viewCourseware"
      >
        <view class="courseware-preview">
          <image src="{{item.cover}}" class="courseware-cover" mode="aspectFit" />
          <view class="courseware-badge" wx:if="{{item.isNew}}">
            æ–°
          </view>
        </view>
        <view class="courseware-info">
          <view class="courseware-title">{{item.title}}</view>
          <view class="courseware-desc">{{item.description}}</view>
          <view class="courseware-meta">
            <view class="meta-item">
              <view class="meta-icon">ğŸ“š</view>
              <text>{{item.subject}}</text>
            </view>
            <view class="meta-item">
              <view class="meta-icon">ğŸ“„</view>
              <text>{{item.slides}}é¡µ</text>
            </view>
            <view class="meta-item">
              <view class="meta-icon">ğŸ“…</view>
              <text>{{item.createTime}}</text>
            </view>
          </view>
        </view>
        <view class="courseware-actions">
          <t-button 
            size="small" 
            theme="light"
            data-courseware="{{item}}"
            bind:tap="downloadCoursewareItem"
            catch:tap="true"
          >
            ä¸‹è½½
          </t-button>
          <t-button 
            size="small" 
            theme="primary"
            data-courseware="{{item}}"
            bind:tap="useCourseware"
            catch:tap="true"
          >
            ä½¿ç”¨
          </t-button>
        </view>
      </view>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <t-empty 
      wx:if="{{filteredCourseware.length === 0 && !loading}}"
      icon="folder"
      description="æš‚æ— ç›¸å…³è¯¾ä»¶"
    />
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <t-empty 
    wx:if="{{isEmpty && !loading}}"
    icon="data"
    description="æš‚æ— æ•°æ®"
  />

  <!-- Toastæç¤º -->
  <t-toast 
    visible="{{showToast}}"
    message="{{toastMessage}}"
    bind:close="onToastClose"
  />

  <!-- åŠ¨ç”»è¯¦æƒ…å¼¹çª— -->
  <t-popup 
    visible="{{showAnimationDetail}}"
    placement="bottom"
    bind:visible-change="onAnimationDetailClose"
  >
    <view class="animation-detail" wx:if="{{selectedAnimation}}">
      <view class="detail-header">
        <view class="detail-title">{{selectedAnimation.title}}</view>
        <view class="detail-close" bindtap="closeAnimationDetail">âœ•</view>
      </view>
      
      <view class="detail-video">
        <video 
          src="{{selectedAnimation.videoUrl}}"
          poster="{{selectedAnimation.thumbnail}}"
          controls
          class="animation-video"
        ></video>
      </view>
      
      <view class="detail-info">
        <view class="info-row">
          <view class="info-label">æè¿°</view>
          <view class="info-value">{{selectedAnimation.description}}</view>
        </view>
        <view class="info-row">
          <view class="info-label">ç§‘ç›®</view>
          <view class="info-value">{{selectedAnimation.subject}}</view>
        </view>
        <view class="info-row">
          <view class="info-label">æ—¶é•¿</view>
          <view class="info-value">{{selectedAnimation.duration}}åˆ†é’Ÿ</view>
        </view>
        <view class="info-row">
          <view class="info-label">çŸ¥è¯†ç‚¹</view>
          <view class="info-value">
            <view 
              wx:for="{{selectedAnimation.knowledgePoints}}" 
              wx:key="*this"
              class="knowledge-tag"
            >
              {{item}}
            </view>
          </view>
        </view>
      </view>
      
      <view class="detail-actions">
        <t-button 
          theme="light" 
          size="large"
          bind:tap="collectSelectedAnimation"
        >
          {{selectedAnimation.collected ? 'å–æ¶ˆæ”¶è—' : 'æ”¶è—åŠ¨ç”»'}}
        </t-button>
        <t-button 
          theme="primary" 
          size="large"
          bind:tap="useAnimation"
        >
          ä½¿ç”¨åŠ¨ç”»
        </t-button>
      </view>
    </view>
  </t-popup>

  <!-- è¯¾ä»¶è¯¦æƒ…å¼¹çª— -->
  <t-popup 
    visible="{{showCoursewareDetail}}"
    placement="bottom"
    bind:visible-change="onCoursewareDetailClose"
  >
    <view class="courseware-detail" wx:if="{{selectedCoursewareItem}}">
      <view class="detail-header">
        <view class="detail-title">{{selectedCoursewareItem.title}}</view>
        <view class="detail-close" bindtap="closeCoursewareDetail">âœ•</view>
      </view>
      
      <view class="detail-preview">
        <image 
          src="{{selectedCoursewareItem.cover}}"
          class="courseware-preview-image"
          mode="aspectFit"
        />
      </view>
      
      <view class="detail-info">
        <view class="info-row">
          <view class="info-label">æè¿°</view>
          <view class="info-value">{{selectedCoursewareItem.description}}</view>
        </view>
        <view class="info-row">
          <view class="info-label">ç§‘ç›®</view>
          <view class="info-value">{{selectedCoursewareItem.subject}}</view>
        </view>
        <view class="info-row">
          <view class="info-label">é¡µæ•°</view>
          <view class="info-value">{{selectedCoursewareItem.slides}}é¡µ</view>
        </view>
        <view class="info-row">
          <view class="info-label">åˆ›å»ºæ—¶é—´</view>
          <view class="info-value">{{selectedCoursewareItem.createTime}}</view>
        </view>
        <view class="info-row">
          <view class="info-label">æ ‡ç­¾</view>
          <view class="info-value">
            <view 
              wx:for="{{selectedCoursewareItem.tags}}" 
              wx:key="*this"
              class="courseware-tag"
            >
              {{item}}
            </view>
          </view>
        </view>
      </view>
      
      <view class="detail-actions">
        <t-button 
          theme="light" 
          size="large"
          bind:tap="downloadSelectedCourseware"
        >
          ä¸‹è½½è¯¾ä»¶
        </t-button>
        <t-button 
          theme="primary" 
          size="large"
          bind:tap="useSelectedCourseware"
        >
          ç«‹å³ä½¿ç”¨
        </t-button>
      </view>
    </view>
  </t-popup>
</view>