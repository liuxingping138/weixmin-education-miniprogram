<!--æ¦‚è§ˆé¡µé¢-->
<view class="dashboard">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view wx:elif="{{error}}" class="error-container">
    <view class="error-icon">âš ï¸</view>
    <text class="error-message">{{error}}</text>
    <button class="retry-btn" bindtap="onRetry">é‡è¯•</button>
  </view>

  <!-- æ­£å¸¸å†…å®¹ -->
  <view wx:else class="dashboard-content">
    <!-- ç»Ÿè®¡å¡ç‰‡åŒºåŸŸ -->
    <view class="stats-section">
      <view class="section-title">æ•°æ®æ¦‚è§ˆ</view>
      
      <view class="stats-grid">
        <!-- å­¦ç”Ÿç»Ÿè®¡ -->
        <view class="stat-card" bindtap="onGoToStudents">
          <view class="stat-icon student-icon">ğŸ‘¥</view>
          <view class="stat-content">
            <view class="stat-number">{{stats.students.total}}</view>
            <view class="stat-label">æ€»å­¦ç”Ÿæ•°</view>
            <view class="stat-detail">
              æ´»è·ƒ: {{stats.students.active}} | éæ´»è·ƒ: {{stats.students.inactive}}
            </view>
          </view>
        </view>

        <!-- æ ‡ç­¾ç»Ÿè®¡ -->
        <view class="stat-card" bindtap="onGoToTags">
          <view class="stat-icon tag-icon">ğŸ·ï¸</view>
          <view class="stat-content">
            <view class="stat-number">{{stats.tags.total}}</view>
            <view class="stat-label">æ ‡ç­¾æ€»æ•°</view>
            <view class="stat-detail">
              ç³»ç»Ÿ: {{stats.tags.system}} | è‡ªå®šä¹‰: {{stats.tags.custom}}
            </view>
          </view>
        </view>

        <!-- å¹³å‡è¿›åº¦ -->
        <view class="stat-card">
          <view class="stat-icon progress-icon">ğŸ“Š</view>
          <view class="stat-content">
            <view class="stat-number">{{stats.students.avgProgress}}%</view>
            <view class="stat-label">å¹³å‡è¿›åº¦</view>
            <view class="stat-detail">å­¦ä¹ å®Œæˆåº¦</view>
          </view>
        </view>
      </view>
    </view>

    <!-- å¹´çº§åˆ†å¸ƒ -->
    <view class="grade-section" wx:if="{{Object.keys(gradeDistribution).length > 0}}">
      <view class="section-title">å¹´çº§åˆ†å¸ƒ</view>
      <view class="grade-list">
        <view 
          wx:for="{{Object.keys(gradeDistribution)}}" 
          wx:key="*this"
          class="grade-item"
        >
          <view class="grade-name">{{item}}</view>
          <view class="grade-count">{{gradeDistribution[item]}}äºº</view>
        </view>
      </view>
    </view>

    <!-- æœ€è¿‘æ´»è·ƒå­¦ç”Ÿ -->
    <view class="recent-section" wx:if="{{recentActiveStudents.length > 0}}">
      <view class="section-header">
        <view class="section-title">æœ€è¿‘æ´»è·ƒ</view>
        <view class="section-more" bindtap="onGoToStudents">æŸ¥çœ‹å…¨éƒ¨</view>
      </view>
      
      <view class="student-list">
        <view 
          wx:for="{{recentActiveStudents}}" 
          wx:key="id"
          class="student-item"
          data-student-id="{{item.id}}"
          bindtap="onGoToStudentDetail"
        >
          <view class="student-avatar">
            <image 
              src="{{item.avatar || '/images/default-avatar.png'}}" 
              class="avatar-image"
              mode="aspectFill"
            />
          </view>
          <view class="student-info">
            <view class="student-name">{{item.name}}</view>
            <view class="student-grade">{{item.grade}}</view>
            <view class="student-time">{{item.lastActiveTime}}</view>
          </view>
          <view class="student-progress">
            <view class="progress-bar">
              <view 
                class="progress-fill" 
                style="width: {{item.progress}}%"
              ></view>
            </view>
            <view class="progress-text">{{item.progress}}%</view>
          </view>
        </view>
      </view>
    </view>

    <!-- å¿«é€Ÿæ“ä½œ -->
    <view class="action-section">
      <view class="section-title">å¿«é€Ÿæ“ä½œ</view>
      <view class="action-grid">
        <view class="action-item" bindtap="onAddStudent">
          <view class="action-icon">â•</view>
          <view class="action-text">æ·»åŠ å­¦ç”Ÿ</view>
        </view>
        <view class="action-item" bindtap="onGoToStudents">
          <view class="action-icon">ğŸ‘¥</view>
          <view class="action-text">å­¦ç”Ÿç®¡ç†</view>
        </view>
        <view class="action-item" bindtap="onGoToTags">
          <view class="action-icon">ğŸ·ï¸</view>
          <view class="action-text">æ ‡ç­¾ç®¡ç†</view>
        </view>
      </view>
    </view>
  </view>
</view>