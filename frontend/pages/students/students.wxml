<!--å­¦ç”Ÿç®¡ç†é¡µé¢-->
<view class="students-page">
  <!-- æœç´¢æ  -->
  <view class="search-section">
    <view class="search-bar">
      <view class="search-input-wrapper">
        <input 
          class="search-input"
          placeholder="æœç´¢å­¦ç”Ÿå§“åã€å¹´çº§..."
          value="{{searchKeyword}}"
          bindinput="onSearchInput"
        />
        <view wx:if="{{searchKeyword}}" class="clear-search" bindtap="onClearSearch">
          âœ•
        </view>
      </view>
      <view class="filter-btn" bindtap="onShowFilter">
        ç­›é€‰
      </view>
    </view>
    
    <!-- ç­›é€‰æ¡ä»¶æ˜¾ç¤º -->
    <view wx:if="{{filters.status || filters.tags.length > 0}}" class="active-filters">
      <view wx:if="{{filters.status}}" class="filter-tag">
        çŠ¶æ€: {{filters.status === 'active' ? 'æ´»è·ƒ' : 'éæ´»è·ƒ'}}
      </view>
      <view wx:for="{{filters.tags}}" wx:key="*this" class="filter-tag">
        {{getTagName(item)}}
      </view>
      <view class="clear-filters" bindtap="onClearFilter">æ¸…ç©º</view>
    </view>
  </view>

  <!-- æ“ä½œæ  -->
  <view class="action-bar">
    <view class="student-count">
      å…± {{pagination.total}} ä¸ªå­¦ç”Ÿ
    </view>
    <view class="action-buttons">
      <view wx:if="{{!isSelectionMode}}" class="action-btn" bindtap="onToggleSelectionMode">
        æ‰¹é‡æ“ä½œ
      </view>
      <view wx:else class="selection-actions">
        <view class="selected-count">å·²é€‰ {{selectedStudents.length}}</view>
        <view class="action-btn secondary" bindtap="onToggleSelectAll">
          {{selectedStudents.length === students.length ? 'å–æ¶ˆå…¨é€‰' : 'å…¨é€‰'}}
        </view>
        <view class="action-btn danger" bindtap="onBatchDelete">åˆ é™¤</view>
        <view class="action-btn" bindtap="onToggleSelectionMode">å–æ¶ˆ</view>
      </view>
    </view>
  </view>

  <!-- å­¦ç”Ÿåˆ—è¡¨ -->
  <view class="students-content">
    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{loading}}" class="loading-container">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- é”™è¯¯çŠ¶æ€ -->
    <view wx:elif="{{error}}" class="error-container">
      <view class="error-icon">âš ï¸</view>
      <text class="error-message">{{error}}</text>
      <button class="retry-btn" bindtap="onRetry">é‡è¯•</button>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:elif="{{students.length === 0}}" class="empty-container">
      <view class="empty-icon">ğŸ‘¥</view>
      <text class="empty-message">æš‚æ— å­¦ç”Ÿæ•°æ®</text>
      <button class="add-btn" bindtap="onAddStudent">æ·»åŠ ç¬¬ä¸€ä¸ªå­¦ç”Ÿ</button>
    </view>

    <!-- å­¦ç”Ÿåˆ—è¡¨ -->
    <view wx:else class="student-list">
      <view 
        wx:for="{{students}}" 
        wx:key="id"
        class="student-card {{isSelectionMode ? 'selection-mode' : ''}} {{selectedStudents.indexOf(item.id) > -1 ? 'selected' : ''}}"
        data-student-id="{{item.id}}"
        bindtap="onGoToStudentDetail"
      >
        <!-- é€‰æ‹©æ¡† -->
        <view wx:if="{{isSelectionMode}}" class="selection-checkbox">
          <view class="checkbox {{selectedStudents.indexOf(item.id) > -1 ? 'checked' : ''}}">
            <text wx:if="{{selectedStudents.indexOf(item.id) > -1}}">âœ“</text>
          </view>
        </view>

        <!-- å­¦ç”Ÿå¤´åƒ -->
        <view class="student-avatar">
          <image 
            src="{{item.avatar || '/images/default-avatar.png'}}" 
            class="avatar-image"
            mode="aspectFill"
          />
          <view class="status-indicator {{item.status}}"></view>
        </view>

        <!-- å­¦ç”Ÿä¿¡æ¯ -->
        <view class="student-info">
          <view class="student-header">
            <view class="student-name">{{item.name}}</view>
            <view class="student-grade">{{item.grade}}</view>
          </view>
          
          <view class="student-details">
            <view class="detail-item">
              <text class="detail-label">å¹´é¾„:</text>
              <text class="detail-value">{{item.age}}å²</text>
            </view>
            <view class="detail-item">
              <text class="detail-label">è¿›åº¦:</text>
              <text class="detail-value">{{item.progress}}%</text>
            </view>
          </view>

          <!-- å­¦ç”Ÿæ ‡ç­¾ -->
          <view wx:if="{{item.tags && item.tags.length > 0}}" class="student-tags">
            <view 
              wx:for="{{item.tags}}" 
              wx:for-item="tagId"
              wx:key="*this"
              class="tag"
              style="background-color: {{getTagColor(tagId)}}20; color: {{getTagColor(tagId)}}"
            >
              {{getTagName(tagId)}}
            </view>
          </view>

          <!-- æœ€åæ´»è·ƒæ—¶é—´ -->
          <view class="last-active">
            æœ€åæ´»è·ƒ: {{item.lastActiveTime}}
          </view>
        </view>

        <!-- è¿›åº¦æ¡ -->
        <view class="progress-section">
          <view class="progress-bar">
            <view 
              class="progress-fill" 
              style="width: {{item.progress}}%"
            ></view>
          </view>
          <view class="progress-text">{{item.progress}}%</view>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view wx:if="{{loadingMore}}" class="loading-more">
      <view class="loading-spinner small"></view>
      <text class="loading-text">åŠ è½½æ›´å¤š...</text>
    </view>

    <!-- æ²¡æœ‰æ›´å¤šæ•°æ® -->
    <view wx:if="{{!pagination.hasMore && students.length > 0}}" class="no-more">
      æ²¡æœ‰æ›´å¤šæ•°æ®äº†
    </view>
  </view>

  <!-- ç­›é€‰é¢æ¿ -->
  <view wx:if="{{showFilterPanel}}" class="filter-panel">
    <view class="filter-mask" bindtap="onHideFilter"></view>
    <view class="filter-content">
      <view class="filter-header">
        <view class="filter-title">ç­›é€‰æ¡ä»¶</view>
        <view class="filter-close" bindtap="onHideFilter">âœ•</view>
      </view>

      <!-- çŠ¶æ€ç­›é€‰ -->
      <view class="filter-section">
        <view class="filter-section-title">å­¦ç”ŸçŠ¶æ€</view>
        <view class="filter-options">
          <view 
            class="filter-option {{filters.status === 'active' ? 'active' : ''}}"
            data-status="active"
            bindtap="onStatusFilter"
          >
            æ´»è·ƒå­¦ç”Ÿ
          </view>
          <view 
            class="filter-option {{filters.status === 'inactive' ? 'active' : ''}}"
            data-status="inactive"
            bindtap="onStatusFilter"
          >
            éæ´»è·ƒå­¦ç”Ÿ
          </view>
        </view>
      </view>

      <!-- æ ‡ç­¾ç­›é€‰ -->
      <view class="filter-section">
        <view class="filter-section-title">æ ‡ç­¾ç­›é€‰</view>
        <view class="filter-tags">
          <view 
            wx:for="{{tags}}" 
            wx:key="id"
            class="filter-tag-option {{filters.tags.indexOf(item.id) > -1 ? 'active' : ''}}"
            data-tag-id="{{item.id}}"
            bindtap="onTagFilter"
            style="border-color: {{item.color}}; color: {{filters.tags.indexOf(item.id) > -1 ? item.color : '#666'}}"
          >
            {{item.name}}
          </view>
        </view>
      </view>

      <!-- ç­›é€‰æ“ä½œ -->
      <view class="filter-actions">
        <button class="filter-btn secondary" bindtap="onClearFilter">æ¸…ç©ºç­›é€‰</button>
        <button class="filter-btn primary" bindtap="onHideFilter">ç¡®å®š</button>
      </view>
    </view>
  </view>

  <!-- æ·»åŠ æŒ‰é’® -->
  <view wx:if="{{!isSelectionMode}}" class="fab" bindtap="onAddStudent">
    <text class="fab-icon">+</text>
  </view>
</view>