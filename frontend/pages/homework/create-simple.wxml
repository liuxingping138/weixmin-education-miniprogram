<!--pages/homework/create-simple.wxml - 简化版作业发布-->
<view class="container">
  <!-- 加载状态 -->
  <t-loading wx:if="{{loading}}" theme="circular" size="40rpx" text="加载中..." />
  
  <view wx:else class="content">
    <!-- 页面标题 -->
    <view class="page-header">
      <text class="page-title">发布作业</text>
      <text class="page-subtitle">简单几步，轻松发布作业</text>
    </view>
    
    <!-- 快速模板 -->
    <view class="template-section">
      <view class="section-title">
        <t-icon name="template" size="32rpx" />
        <text>快速模板</text>
      </view>
      <view class="template-list">
        <view class="template-item" bindtap="useTemplate" data-type="math">
          <t-icon name="calculate" color="#667eea" />
          <text>数学作业</text>
        </view>
        <view class="template-item" bindtap="useTemplate" data-type="chinese">
          <t-icon name="edit" color="#4facfe" />
          <text>语文作业</text>
        </view>
        <view class="template-item" bindtap="useTemplate" data-type="english">
          <t-icon name="translate" color="#43e97b" />
          <text>英语作业</text>
        </view>
      </view>
    </view>
    
    <!-- 基本信息 -->
    <view class="form-section">
      <view class="section-title">
        <t-icon name="edit" size="32rpx" />
        <text>基本信息</text>
      </view>
      
      <!-- 作业标题 -->
      <view class="form-item">
        <view class="form-label">作业标题 <text class="required">*</text></view>
        <t-input
          value="{{title}}"
          placeholder="请输入作业标题"
          bind:change="onTitleInput"
          maxlength="50"
        />
        <view wx:if="{{errors.title}}" class="error-text">{{errors.title}}</view>
      </view>
      
      <!-- 作业描述 -->
      <view class="form-item">
        <view class="form-label">作业描述 <text class="required">*</text></view>
        <t-textarea
          value="{{description}}"
          placeholder="请输入作业要求和说明"
          bind:change="onDescriptionInput"
          maxlength="200"
          autosize
        />
        <view wx:if="{{errors.description}}" class="error-text">{{errors.description}}</view>
      </view>
      
      <!-- 科目选择 -->
      <view class="form-item">
        <view class="form-label">科目</view>
        <picker range="{{subjects}}" range-key="label" value="{{subjectIndex}}" bind:change="onSubjectChange">
          <view class="picker-display">
            <text>{{subjects[subjectIndex].label}}</text>
            <t-icon name="chevron-right" />
          </view>
        </picker>
      </view>
      
      <!-- 截止时间 -->
      <view class="form-item">
        <view class="form-label">截止时间</view>
        <view class="datetime-picker">
          <picker mode="date" value="{{dueDate}}" bind:change="onDueDateChange">
            <view class="picker-item">
              <t-icon name="calendar" />
              <text>{{dueDate || '选择日期'}}</text>
            </view>
          </picker>
          <picker mode="time" value="{{dueTime}}" bind:change="onDueTimeChange">
            <view class="picker-item">
              <t-icon name="time" />
              <text>{{dueTime}}</text>
            </view>
          </picker>
        </view>
      </view>
    </view>
    
    <!-- 班级选择 -->
    <view class="form-section">
      <view class="section-title">
        <t-icon name="usergroup" size="32rpx" />
        <text>选择班级</text>
        <text class="required">*</text>
      </view>
      
      <view class="class-list">
        <view 
          wx:for="{{classList}}" 
          wx:key="id"
          class="class-item {{selectedClasses.includes(item.id) ? 'selected' : ''}}"
          bindtap="onClassToggle"
          data-id="{{item.id}}"
        >
          <view class="class-info">
            <text class="class-name">{{item.name}}</text>
            <text class="student-count">{{item.studentCount}}人</text>
          </view>
          <t-icon 
            name="{{selectedClasses.includes(item.id) ? 'check-circle-filled' : 'circle'}}"
            color="{{selectedClasses.includes(item.id) ? '#0052d9' : '#dcdcdc'}}"
          />
        </view>
      </view>
      <view wx:if="{{errors.classes}}" class="error-text">{{errors.classes}}</view>
    </view>
    
    <!-- 题目设置 -->
    <view class="form-section">
      <view class="section-title">
        <t-icon name="help-circle" size="32rpx" />
        <text>题目设置</text>
        <text class="optional">(可选)</text>
      </view>
      
      <view wx:if="{{questions.length === 0}}" class="empty-questions">
        <t-icon name="help-circle" size="80rpx" color="#dcdcdc" />
        <text>暂无题目，点击下方按钮添加</text>
      </view>
      
      <view wx:else class="questions-list">
        <view 
          wx:for="{{questions}}" 
          wx:key="id"
          class="question-item"
        >
          <view class="question-header">
            <text class="question-number">第{{index + 1}}题</text>
            <view class="question-actions">
              <text class="points-input">
                <input 
                  type="number" 
                  value="{{item.points}}" 
                  placeholder="分值"
                  data-index="{{index}}"
                  data-field="points"
                  bind:input="onQuestionInput"
                />
                分
              </text>
              <t-icon 
                name="delete" 
                color="#e34d59" 
                bind:tap="removeQuestion"
                data-index="{{index}}"
              />
            </view>
          </view>
          
          <view class="question-content">
            <t-textarea
              value="{{item.content}}"
              placeholder="请输入题目内容"
              data-index="{{index}}"
              data-field="content"
              bind:change="onQuestionInput"
              autosize
            />
          </view>
          
          <view class="question-answer">
            <t-input
              value="{{item.answer}}"
              placeholder="参考答案(可选)"
              data-index="{{index}}"
              data-field="answer"
              bind:change="onQuestionInput"
            />
          </view>
        </view>
      </view>
      
      <view class="add-question">
        <t-button theme="light" size="large" bind:tap="addQuestion">
          <t-icon name="add" />
          添加题目
        </t-button>
      </view>
    </view>
    
    <!-- 操作按钮 -->
    <view class="action-buttons">
      <t-button theme="light" size="large" bind:tap="saveDraft">
        保存草稿
      </t-button>
      <t-button theme="light" size="large" bind:tap="previewHomework">
        预览
      </t-button>
      <t-button 
        theme="primary" 
        size="large" 
        bind:tap="publishHomework"
        loading="{{submitting}}"
        disabled="{{submitting}}"
      >
        {{submitting ? '发布中...' : '发布作业'}}
      </t-button>
    </view>
  </view>
</view>