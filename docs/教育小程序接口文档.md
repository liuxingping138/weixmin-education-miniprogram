# 教育小程序后端 API 设计文档（基于 FastAPI）

## 一、概述
本接口文档适用于 **教育小程序** 的后端服务，基于 **FastAPI + MySQL** 开发。采用 RESTful 风格接口，统一返回 JSON 格式数据。

---

## 二、通用规范
- **协议**：HTTPS
- **数据格式**：`application/json`
- **鉴权方式**：JWT Token
- **错误码规范**：
  - `200` 成功
  - `400` 请求参数错误
  - `401` 未授权或 Token 失效
  - `403` 无权限
  - `404` 数据不存在
  - `500` 服务器错误

统一返回结构：
```json
{
  "code": 200,
  "message": "success",
  "data": {}
}
```

---

## 三、接口设计

### 1. 用户与认证模块
#### 1.1 用户注册
- **URL**：`POST /api/auth/register`
- **参数**：
```json
{
  "username": "zhangsan",
  "password": "123456",
  "role": "student"   // student | teacher | parent
}
```
- **返回**：
```json
{
  "code": 200,
  "data": {"user_id": 1}
}
```

#### 1.2 用户登录
- **URL**：`POST /api/auth/login`
- **参数**：
```json
{
  "username": "zhangsan",
  "password": "123456"
}
```
- **返回**：
```json
{
  "code": 200,
  "data": {
    "token": "jwt-token-string",
    "role": "student"
  }
}
```

#### 1.3 获取用户信息
- **URL**：`GET /api/users/me`
- **Header**：`Authorization: Bearer <token>`
- **返回**：
```json
{
  "code": 200,
  "data": {
    "user_id": 1,
    "username": "zhangsan",
    "role": "student"
  }
}
```

---

### 2. 班级管理模块
#### 2.1 创建班级（教师）
- **URL**：`POST /api/classes`
- **参数**：
```json
{
  "name": "高一三班",
  "year": 2025
}
```
- **返回**：
```json
{"code":200, "data":{"class_id": 101}}
```

#### 2.2 获取班级学生列表
- **URL**：`GET /api/classes/{class_id}/students`
- **返回**：
```json
{
  "code":200,
  "data":[
    {"student_id":1, "name":"张三", "score":88},
    {"student_id":2, "name":"李四", "score":92}
  ]
}
```

#### 2.3 班级排行榜
- **URL**：`GET /api/classes/{class_id}/ranking`
- **返回**：
```json
{
  "code":200,
  "data":[
    {"student_id":1, "name":"张三", "points":120},
    {"student_id":2, "name":"李四", "points":110}
  ]
}
```

---

### 3. 积分商城模块
#### 3.1 获取商品列表
- **URL**：`GET /api/store/items`
- **返回**：
```json
{
  "code":200,
  "data":[
    {"item_id":1, "name":"定制水杯", "points":100},
    {"item_id":2, "name":"文具礼包", "points":80}
  ]
}
```

#### 3.2 积分兑换
- **URL**：`POST /api/store/redeem`
- **参数**：
```json
{
  "item_id": 1
}
```
- **返回**：
```json
{"code":200, "message":"兑换成功"}
```

---

### 4. 作业系统模块
#### 4.1 发布作业（教师）
- **URL**：`POST /api/homework`
- **参数**：
```json
{
  "title": "二次函数作业",
  "class_id": 101,
  "questions": [1,2,3,4]
}
```
- **返回**：
```json
{"code":200, "data":{"homework_id":501}}
```

#### 4.2 提交作业（学生）
- **URL**：`POST /api/homework/{homework_id}/submit`
- **参数**：
```json
{
  "answers": {"1":"A", "2":"B", "3":"C"}
}
```
- **返回**：
```json
{"code":200, "message":"提交成功"}
```

#### 4.3 作业正确率分析
- **URL**：`GET /api/homework/{homework_id}/stats`
- **返回**：
```json
{
  "code":200,
  "data":{
    "total_students":30,
    "question_stats":[
      {"question_id":1, "correct_rate":0.85},
      {"question_id":2, "correct_rate":0.60}
    ]
  }
}
```

---

### 5. 学生成长与分析
#### 5.1 六边形能力分析
- **URL**：`GET /api/students/{student_id}/analysis`
- **返回**：
```json
{
  "code":200,
  "data":{
    "calculation":80,
    "logic":75,
    "modeling":70,
    "analysis":85,
    "space":65,
    "creativity":78
  }
}
```

#### 5.2 学习档案生成 PDF
- **URL**：`POST /api/students/{student_id}/export`
- **返回**：
```json
{"code":200, "message":"生成成功", "url":"https://cos.example.com/xxx.pdf"}
```

---

## 四、后续扩展接口
- 课件生成（自动 PPT/动画）
- 微信群推送（调用微信开放接口）
- AI 出题与个性化推荐
