# 网络教学班级管理平台 - 开发规范

## 📋 代码规范

### 文件命名规范

#### 页面文件命名
```
pages/
├── dashboard/           # 概览页 (kebab-case)
├── students/           # 学生管理页
├── student-detail/     # 学生详情页
├── tags/              # 标签管理页
└── profile/           # 个人中心页
```

#### 组件文件命名
```
components/
├── student-card/       # 学生卡片组件 (kebab-case)
├── tag-selector/       # 标签选择器组件
├── stats-card/         # 统计卡片组件
└── action-sheet/       # 操作面板组件
```

#### 工具文件命名
```
utils/
├── data-manager.js     # 数据管理 (kebab-case + .js)
├── tag-utils.js        # 标签工具
├── storage-utils.js    # 存储工具
└── common-utils.js     # 通用工具
```

### JavaScript 代码规范

#### 变量命名
```javascript
// 使用 camelCase 命名变量和函数
const studentList = []
const tagManager = new TagManager()

// 使用 PascalCase 命名类和构造函数
class StudentManager {
  constructor() {}
}

// 使用 UPPER_SNAKE_CASE 命名常量
const STORAGE_KEYS = {
  STUDENTS: 'students_data',
  TAGS: 'tags_data'
}

// 使用有意义的变量名
const activeStudentCount = students.filter(s => s.status === 'active').length
// 避免使用无意义的变量名
// const count = students.filter(s => s.status === 'active').length
```

#### 函数规范
```javascript
// 函数名使用动词开头，描述功能
function getStudentById(id) {
  return students.find(student => student.id === id)
}

function updateStudentTags(studentId, tags) {
  // 函数体不超过 20 行
  const student = getStudentById(studentId)
  if (!student) {
    throw new Error('Student not found')
  }
  
  student.tags = tags
  student.updateTime = new Date().toISOString()
  
  return saveStudent(student)
}

// 使用 JSDoc 注释
/**
 * 为学生添加标签
 * @param {string} studentId - 学生ID
 * @param {string} tagId - 标签ID
 * @returns {boolean} 是否添加成功
 */
function addTagToStudent(studentId, tagId) {
  // 实现逻辑
}
```

#### 对象和数组操作
```javascript
// 使用解构赋值
const { name, grade, tags } = student
const [firstTag, ...otherTags] = student.tags

// 使用扩展运算符
const newStudent = { ...student, updateTime: new Date() }
const allTags = [...systemTags, ...customTags]

// 使用数组方法而非循环
const activeStudents = students.filter(s => s.status === 'active')
const studentNames = students.map(s => s.name)
const hasActiveStudent = students.some(s => s.status === 'active')
```

#### 异步处理
```javascript
// 使用 async/await 而非 Promise.then
async function loadStudentData() {
  try {
    const data = await StorageUtils.get(STORAGE_KEYS.STUDENTS)
    return data || []
  } catch (error) {
    console.error('加载学生数据失败:', error)
    return []
  }
}

// 错误处理
async function saveStudent(student) {
  try {
    await StorageUtils.set(STORAGE_KEYS.STUDENTS, students)
    return { success: true }
  } catch (error) {
    return { success: false, error: error.message }
  }
}
```

### WXML 模板规范

#### 标签和属性
```xml
<!-- 使用语义化标签 -->
<view class="student-card">
  <text class="student-name">{{student.name}}</text>
  <text class="student-grade">{{student.grade}}</text>
</view>

<!-- 属性使用双引号，按字母顺序排列 -->
<button 
  bindtap="onAddStudent"
  class="btn btn-primary"
  type="primary"
>
  添加学生
</button>

<!-- 条件渲染使用 wx:if -->
<view wx:if="{{students.length > 0}}" class="student-list">
  <!-- 学生列表 -->
</view>
<view wx:else class="empty-state">
  <text>暂无学生数据</text>
</view>

<!-- 列表渲染 -->
<view 
  wx:for="{{students}}" 
  wx:key="id"
  wx:for-item="student"
  class="student-item"
>
  <text>{{student.name}}</text>
</view>
```

#### 事件处理
```xml
<!-- 事件名使用 on 前缀 -->
<button bindtap="onAddStudent">添加</button>
<input bindinput="onSearchInput" placeholder="搜索学生" />
<picker bindchange="onTagChange" range="{{tagList}}">选择标签</picker>

<!-- 传递参数使用 data-* 属性 -->
<button 
  bindtap="onDeleteStudent"
  data-student-id="{{student.id}}"
>
  删除
</button>
```

### WXSS 样式规范

#### 选择器命名
```css
/* 使用 BEM 命名规范 */
.student-card {
  /* 块 (Block) */
}

.student-card__name {
  /* 元素 (Element) */
}

.student-card--active {
  /* 修饰符 (Modifier) */
}

.student-card__tag--primary {
  /* 元素的修饰符 */
}
```

#### 样式组织
```css
/* 1. 布局属性 */
.student-card {
  display: flex;
  flex-direction: column;
  position: relative;
  
  /* 2. 盒模型属性 */
  width: 100%;
  height: auto;
  padding: 30rpx;
  margin-bottom: 20rpx;
  border-radius: 16rpx;
  
  /* 3. 视觉属性 */
  background-color: #ffffff;
  box-shadow: 0 2rpx 12rpx rgba(0, 0, 0, 0.08);
  
  /* 4. 字体属性 */
  font-size: 28rpx;
  color: #333333;
  
  /* 5. 其他属性 */
  transition: all 0.3s ease;
}
```

#### 响应式设计
```css
/* 使用 rpx 单位 */
.container {
  padding: 20rpx;
  font-size: 28rpx; /* 16px */
}

/* 媒体查询 */
@media (max-width: 750rpx) {
  .student-grid {
    grid-template-columns: 1fr;
  }
}

@media (min-width: 751rpx) {
  .student-grid {
    grid-template-columns: 1fr 1fr;
  }
}
```

## 🗂️ 项目结构规范

### 目录结构
```
frontend/
├── app.js                 # 应用入口
├── app.json              # 应用配置
├── app.wxss              # 全局样式
├── sitemap.json          # 站点地图
├── project.config.json   # 项目配置
├── pages/                # 页面目录
│   ├── dashboard/        # 概览页
│   ├── students/         # 学生管理
│   ├── student-detail/   # 学生详情
│   ├── tags/            # 标签管理
│   └── profile/         # 个人中心
├── components/          # 自定义组件
│   ├── student-card/    # 学生卡片
│   ├── tag-selector/    # 标签选择器
│   ├── stats-card/      # 统计卡片
│   └── action-sheet/    # 操作面板
├── utils/               # 工具函数
│   ├── data-manager.js  # 数据管理
│   ├── tag-utils.js     # 标签工具
│   ├── storage-utils.js # 存储工具
│   └── common-utils.js  # 通用工具
├── data/                # 数据文件
│   ├── mock-students.js # 学生数据
│   ├── mock-tags.js     # 标签数据
│   └── constants.js     # 常量定义
└── images/              # 图片资源
    ├── icons/           # 图标
    └── avatars/         # 头像
```

### 页面文件结构
```
pages/students/
├── students.js          # 页面逻辑
├── students.json        # 页面配置
├── students.wxml        # 页面结构
└── students.wxss        # 页面样式
```

### 组件文件结构
```
components/student-card/
├── student-card.js      # 组件逻辑
├── student-card.json    # 组件配置
├── student-card.wxml    # 组件结构
└── student-card.wxss    # 组件样式
```

## 📝 注释规范

### 文件头注释
```javascript
/**
 * 学生数据管理工具
 * @description 提供学生数据的增删改查功能
 * @author 开发者姓名
 * @date 2024-01-01
 * @version 1.0.0
 */
```

### 函数注释
```javascript
/**
 * 获取指定标签的学生列表
 * @param {string} tagId - 标签ID
 * @param {Object} options - 选项参数
 * @param {number} options.limit - 限制数量，默认为10
 * @param {number} options.offset - 偏移量，默认为0
 * @returns {Array<Object>} 学生列表
 * @throws {Error} 当标签不存在时抛出错误
 * @example
 * const students = getStudentsByTag('tag_001', { limit: 5 })
 */
function getStudentsByTag(tagId, options = {}) {
  // 实现逻辑
}
```

### 复杂逻辑注释
```javascript
function calculateStudentStats(students) {
  // 计算学生统计数据
  const stats = {
    total: students.length,
    active: 0,
    inactive: 0,
    avgProgress: 0
  }
  
  // 遍历学生数据，统计各种状态
  let totalProgress = 0
  students.forEach(student => {
    if (student.status === 'active') {
      stats.active++
    } else {
      stats.inactive++
    }
    totalProgress += student.progress || 0
  })
  
  // 计算平均进度，避免除零错误
  stats.avgProgress = students.length > 0 
    ? Math.round(totalProgress / students.length) 
    : 0
    
  return stats
}
```

## 🔧 工具配置

### ESLint 配置
```json
{
  "env": {
    "es6": true,
    "node": true
  },
  "extends": ["eslint:recommended"],
  "parserOptions": {
    "ecmaVersion": 2020,
    "sourceType": "module"
  },
  "rules": {
    "indent": ["error", 2],
    "quotes": ["error", "single"],
    "semi": ["error", "never"],
    "no-console": "warn",
    "no-unused-vars": "error",
    "prefer-const": "error",
    "no-var": "error"
  },
  "globals": {
    "wx": "readonly",
    "App": "readonly",
    "Page": "readonly",
    "Component": "readonly",
    "getApp": "readonly"
  }
}
```

### Prettier 配置
```json
{
  "printWidth": 80,
  "tabWidth": 2,
  "useTabs": false,
  "semi": false,
  "singleQuote": true,
  "quoteProps": "as-needed",
  "trailingComma": "es5",
  "bracketSpacing": true,
  "arrowParens": "avoid"
}
```

## 📊 性能规范

### 代码性能
```javascript
// ✅ 好的做法：使用防抖处理搜索
const searchStudents = debounce((keyword) => {
  const results = students.filter(s => 
    s.name.includes(keyword)
  )
  this.setData({ searchResults: results })
}, 300)

// ❌ 避免：频繁的 setData 调用
onSearchInput(e) {
  const keyword = e.detail.value
  // 每次输入都会触发，性能差
  this.setData({
    searchResults: students.filter(s => s.name.includes(keyword))
  })
}
```

### 渲染性能
```xml
<!-- ✅ 好的做法：使用 wx:if 控制渲染 -->
<view wx:if="{{showStudentList}}" class="student-list">
  <view wx:for="{{students}}" wx:key="id">
    {{item.name}}
  </view>
</view>

<!-- ❌ 避免：使用 hidden 隐藏大量元素 -->
<view hidden="{{!showStudentList}}" class="student-list">
  <view wx:for="{{students}}" wx:key="id">
    {{item.name}}
  </view>
</view>
```

### 内存管理
```javascript
// ✅ 好的做法：及时清理定时器和监听器
onUnload() {
  if (this.timer) {
    clearInterval(this.timer)
    this.timer = null
  }
}

// ✅ 好的做法：避免内存泄漏
onShow() {
  this.loadData()
}

onHide() {
  // 清理不必要的数据
  this.setData({
    tempData: null
  })
}
```

## 🧪 测试规范

### 单元测试
```javascript
// utils/tag-utils.test.js
describe('TagUtils', () => {
  test('should create tag with correct properties', () => {
    const tagData = {
      name: '优秀学生',
      color: '#4CAF50',
      type: 'custom'
    }
    
    const tag = TagUtils.createTag(tagData)
    
    expect(tag.id).toBeDefined()
    expect(tag.name).toBe('优秀学生')
    expect(tag.color).toBe('#4CAF50')
    expect(tag.createTime).toBeDefined()
  })
  
  test('should throw error for invalid tag data', () => {
    expect(() => {
      TagUtils.createTag({})
    }).toThrow('Tag name is required')
  })
})
```

### 页面测试
```javascript
// pages/students/students.test.js
describe('Students Page', () => {
  let page
  
  beforeEach(() => {
    page = new StudentsPage()
    page.onLoad()
  })
  
  test('should load students on page load', () => {
    expect(page.data.students).toBeDefined()
    expect(Array.isArray(page.data.students)).toBe(true)
  })
  
  test('should filter students by search keyword', () => {
    page.onSearchInput({ detail: { value: '张三' } })
    
    const filteredStudents = page.data.searchResults
    expect(filteredStudents.every(s => s.name.includes('张三'))).toBe(true)
  })
})
```

## 📋 代码审查清单

### 功能检查
- [ ] 功能是否按需求实现
- [ ] 边界条件是否处理
- [ ] 错误处理是否完善
- [ ] 用户体验是否友好

### 代码质量检查
- [ ] 代码是否符合规范
- [ ] 变量命名是否清晰
- [ ] 函数是否单一职责
- [ ] 是否有重复代码

### 性能检查
- [ ] 是否有性能瓶颈
- [ ] 内存使用是否合理
- [ ] 是否有不必要的渲染
- [ ] 数据结构是否优化

### 安全检查
- [ ] 输入数据是否验证
- [ ] 敏感信息是否保护
- [ ] 权限控制是否正确
- [ ] XSS 防护是否到位

## 📚 最佳实践

### 数据管理
```javascript
// ✅ 使用统一的数据管理器
class DataManager {
  static async getStudents() {
    try {
      const data = await StorageUtils.get(STORAGE_KEYS.STUDENTS)
      return data || []
    } catch (error) {
      console.error('获取学生数据失败:', error)
      return []
    }
  }
  
  static async saveStudents(students) {
    try {
      await StorageUtils.set(STORAGE_KEYS.STUDENTS, students)
      return { success: true }
    } catch (error) {
      return { success: false, error: error.message }
    }
  }
}
```

### 组件设计
```javascript
// ✅ 组件职责单一，接口清晰
Component({
  properties: {
    student: {
      type: Object,
      required: true
    },
    showTags: {
      type: Boolean,
      value: true
    }
  },
  
  methods: {
    onTap() {
      this.triggerEvent('tap', { student: this.data.student })
    }
  }
})
```

### 错误处理
```javascript
// ✅ 统一的错误处理
function handleError(error, context = '') {
  console.error(`${context}:`, error)
  
  wx.showToast({
    title: '操作失败，请重试',
    icon: 'none'
  })
  
  // 上报错误信息
  reportError(error, context)
}
```

这些开发规范将确保代码质量、可维护性和团队协作效率。所有开发人员都应严格遵循这些规范。